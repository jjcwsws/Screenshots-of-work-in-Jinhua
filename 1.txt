
开新终端运行：source ~/linorobot2_ws/install/setup.bash

source /opt/ros/humble/setup.bash
source ~/linorobot2_ws/install/setup.bash

  选择性考虑：colcon build --symlink-install


工作空间编译运行：

cd ~/linorobot2_ws
source /opt/ros/humble/setup.bash
colcon build --symlink-install
source install/setup.bash
或者：
cd ~/linorobot2_ws
rm -rf build/ install/ log/
colcon build --symlink-install
source install/setup.bash


重新编译流程：
cd ~/linorobot2_ws
colcon build --symlink-install
source install/setup.bash

ros2 run my_robot_bringup serial_node

重新測試:
export LINOROBOT2_BASE=4wd                  # 你已經設了 4wd，好
source ~/linorobot2_ws/install/setup.bash   # 確保 workspace 被 source
ros2 launch linorobot2_gazebo gazebo.launch.py



# 重新加载配置
source ~/.bashrc

~/linorobot2_ws/src/linorobot2/linorobot2_description/urdf/robots/4wd.urdf.xacro


ros2 launch linorobot2_gazebo gazebo.launch.py \
  urdf:=/home/jt/linorobot2_ws/src/linorobot2/linorobot2_description/urdf/robots/4wd.urdf.xacro \
  use_sim_time:=true


cd ~/linorobot2_ws
colcon build --symlink-install
source install/setup.bash

~/linorobot2_ws/src/linorobot2/linorobot2_description/urdf/robot

现在都开终端并运行了，可以在四个终端四步走了:

        启动 Gazebo 仿真环境(如果启动失败，考虑是不是还有别的 gazebo进程，杀掉进程：pkill -f gzserver  pkill -f gzclient  pkill -f gazebo)

ros2 launch linorobot2_gazebo gazebo.launch.py urdf:=/tmp/robot.urdf
ros2 launch linorobot2_gazebo gazebo.launch.py urdf:=/tmp/robot.urdf

ros2 launch linorobot2_gazebo gazebo.launch.py urdf:=/tmp/robot.urdf use_sim_time:=true

ros2 launch linorobot2_gazebo gazebo.launch.py \
  urdf:=/home/jt/linorobot2_ws/src/linorobot2/linorobot2_description/urdf/robots/4wd.urdf.xacro \
  use_sim_time:=true



        启动 SLAM
ros2 launch slam_toolbox online_async_launch.py

        启动 Teleop（键盘控制）
ros2 run teleop_twist_keyboard teleop_twist_keyboard

        在 Rviz 里查看地图
ros2 run rviz2 rviz2

        完整的 Nav2 启动应该这样：

                清理之前的进程
ros2 daemon stop
ros2 daemon star
                启动完整的navigation系统（它会自动激活所有节点）
ros2 launch nav2_bringup navigation_launch.py use_sim_time:=true





2026.1.24新步骤：

        1.开四五个新终端     
cd ~/linorobot2_ws
source ~/linorobot2_ws/install/setup.bash
选择性考虑：colcon build --symlink-install


        2.新开gazebo
ros2 launch linorobot2_gazebo gazebo.launch.py urdf:=/tmp/robot.urdf


        3.启动地图服务器（使用map.yaml）
ros2 run nav2_map_server map_server --ros-args \
    -p yaml_filename:=/home/jt/linorobot2_ws/src/linorobot2/linorobot2_navigation/maps/map.yaml \
    -p use_sim_time:=true


        4.启动AMCL
ros2 launch nav2_bringup localization_launch.py \
    use_sim_time:=true \
    map:=/home/jt/linorobot2_ws/src/linorobot2/linorobot2_navigation/maps/map.yaml


        5.直接使用Nav2的RViz配置（已经正确配置了地图）
ros2 launch nav2_bringup rviz_launch.py


        6.启动完整的navigation系统（它会自动激活所有节点）
ros2 launch nav2_bringup navigation_launch.py use_sim_time:=true




GITHUB推送指南:

	1.# 进入项目目录
cd ~/history_ros

	2.1 # 添加当前目录下所有【已跟踪文件】的更新 (包括日志、代码等，但不会添加.gitignore里指定的新文件)
git add -u

	2.2.# 或者，明确添加日志文件和其他你关心的文件
git add terminal_logs/command_history.log .gitignore

	2.3 #添加有变动的日志文件 (比 `git add -u` 更精准)
git add terminal_logs/command_history.log

        2.4
{
    echo ""
    echo "=== 今日命令备份: $(date '+%Y-%m-%d') ==="
    echo "# 备份时间: $(date '+%H:%M:%S')"
    echo "-------------------------"
    history 40  # 这是关键！添加实际命令
    echo ""
} >> terminal_logs/command_history.log


{
    echo ""
    echo "=== 今日命令备份: $(date '+%Y-%m-%d') ==="
    echo "# 备份时间: $(date '+%H:%M:%S')"
    echo "-------------------------"
    history | grep "$(date '+%Y-%m-%d')" | tail -50
    echo ""
} >> terminal_logs/command_history.log



	3.# 然后提交
git commit -m "docs: 更新终端命令历史"

	4.完成上传：推送到GitHub

git push origin main





测试网络
ip addr			#如果没有看到192....开头的
sudo ip link set ens33 up
sudo dhclient ens33
ping -c 4 8.8.8.8
















实用技能：nl -ba ~/linorobot2_ws/src/linorobot2/linorobot2_description/urdf/robots/4wd.urdf.xacro(类似这样就可以在终端复制文件内容)
         nl -ba ~/linorobot2_ws/src/linorobot2/linorobot2_description/urdf/controllers/skid_steer.urdf.xacro


xacro ~/linorobot2_ws/src/linorobot2/linorobot2_description/urdf/robots/4wd.urdf.xacro > /tmp/ok.urdf





Github从Linux到推送流程：


mkdir history_ros
cd ~/history_ros
mkdir -p terminal_logs
touch terminal_logs/command_history.log

git config --global user.name "Xianen Ling"
git config --global user.email "3326288718@qq.com"
git config --global --list

ssh-keygen -t ed25519 -C "3326288718@.com"

gedit ~/.ssh/id_ed25519.pub
	
ssh -T git@github.com

cd ~/history_ros
{
    echo "=== 备份时间：$(date) ==="
    history 100 | tail -n 100
    echo ""
} >> terminal_logs/command_history.log


cd ~/history_ros
git init
git remote add origin git@github.com:jjcwsws/Mobile-Aloha-re.git
git remote -v
















每日例行检查:

	新开终端，准备编译运行前
source /opt/ros/foxy/setup.bash
source ~/ros2_ws/install/setup.bash
	或者
echo $ROS_DISTRO
	结果必须是：
foxy




	编译两板斧:
colcon build
source ~/.bashrc
ros2 launch linorobot2_gazebo gazebo.launch.py




	查看ros2分支:
source ~/.bashrc
cd ~/ros2_ws/src/linorobot2   or     cd ~/linorobot2_ws/src/linorobot2  
git branch
	* humble
    	  jazzy


        查看ubuntu版本：
lsb_release -a







        下载并安装Gazebo及Gazebo_models:

sudo apt update
sudo apt install ros-humble-gazebo-ros-pkgs ros-humble-gazebo-ros
gazebo --version
        


mkdir -p ~/.gazebo/models
ls -lh ~/.gazebo/models
cd ~/.gazebo/models
git clone https://github.com/osrf/gazebo_models
cp -r gazebo_models/* ~/.gazebo/models/




        离线下载的gazebo_models-master移动到Gazebo_models后，执行以下命令：
        模型移到上一级：

mv ~/.gazebo/models/gazebo_models-master/* ~/.gazebo/models/
rm -rf ~/.gazebo/models/gazebo_models-master




export LIBGL_ALWAYS_SOFTWARE=1
ros2 launch linorobot2_gazebo gazebo.launch.py



sudo rosdep init
rm -rf ~/.ros/rosdep
rosdep update




export LIBGL_ALWAYS_SOFTWARE=1
gazebo   # 或你的 launch 命令





git remote remove origin
git remote add origin git@github.com:jjcwsws/Mobile-Aloha-re.git

 

sudo apt update
sudo apt upgrade


sudo apt install software-properties-common
sudo add-apt-repository universe
sudo apt update

sudo apt install curl gnupg lsb-release
sudo curl -sSL https://raw.githubusercontent.com/ros/rosdistro/master/ros.key \
  -o /usr/share/keyrings/ros-archive-keyring.gpg

echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/ros-archive-keyring.gpg] \
http://packages.ros.org/ros2/ubuntu $(lsb_release -cs) main" | \
sudo tee /etc/apt/sources.list.d/ros2.list



sudo apt update
sudo apt install ros-foxy-desktop


echo "source /opt/ros/foxy/setup.bash" >> ~/.bashrc
source ~/.bashrc

ros2 run demo_nodes_cpp talker

ros2 run demo_nodes_cpp talker



sudo apt install gazebo11 libgazebo11-dev

gazebo





mkdir -p ~/ros2_ws/src
cd ~/ros2_ws
sudo apt update
sudo apt install python3-colcon-common-extensions
colcon build
echo "source ~/ros2_ws/install/setup.bash" >> ~/.bashrc
source ~/.bashrc


cd ~/ros2_ws/src
git clone -b foxy https://github.com/linorobot/linorobot2.git

cd ~/ros2_ws
rosdep update
rosdep install --from-paths src --ignore-src -r -y

colcon build
source install/setup.bash

ros2 launch linorobot2_gazebo gazebo.launch.py







ros2 launch linorobot2_gazebo diffbot.launch.py

ros2 run teleop_twist_keyboard teleop_twist_keyboard








git config --global user.name "Xianen Ling"
git config --global user.email "3326288718@qq.com"


git remote add origin git@github.com:jjcwsws/Mobile-Aloha.git
git remote rm origin
git remote add origin git@github.com:jjcwsws/Mobile-Aloha-re.git

git remote set-url origin git@github.com:jjcwsws/Mobile-Aloha-re.git

sudo apt update
sudo apt install ros-foxy-robot-localization

ros2 launch gazebo_ros gazebo.launch.py world:=/home/yan/ros2_ws/install/linorobot2_gazebo/share/linorobot2_gazebo/worlds/playground.world








# 创建工作空间
mkdir -p ~/linorobot2_ws/src
cd ~/linorobot2_ws/src

# 克隆你的机器人包（假设 linorobot2）
git clone https://github.com/your_org/linorobot2.git

# 返回工作空间根目录
cd ~/linorobot2_ws



cd ~/linorobot2_ws
source install/setup.bash

ros2 launch linorobot2_gazebo gazebo.launch.py








Gazebo 默认会读取 ~/.gazebo/models 下的模型，但你的模型在 gazebo_models-master 里。为了保证 ROS2 可以找到模型，需要设置环境变量：

export GAZEBO_MODEL_PATH=~/.gazebo/models/gazebo_models-master:$GAZEBO_MODEL_PATH


测试：

echo $GAZEBO_MODEL_PATH


应该能看到你刚刚添加的路径。

如果你希望每次开虚拟机都自动生效，可以加到 ~/.bashrc：

echo 'export GAZEBO_MODEL_PATH=~/.gazebo/models/gazebo_models-master:$GAZEBO_MODEL_PATH' >> ~/.bashrc
source ~/.bashrc



        大致流程如下：

Ubuntu 22.04 + ROS 2 Humble

创建ros工作空间 + 下载 Linorobot2

安装 Gazebo + 离线 Gazebo 模型

编译工作空间

安装 slam_toolbox + 其他依赖（Teleop, Rviz）

启动仿真 → 启动 SLAM → 启动 Teleop → 查看 Rviz

可选：Navigation 2









# 启动生命周期管理器，它会自动配置和激活所有节点
ros2 run nav2_lifecycle_manager lifecycle_manager --ros-args \
    -p node_names:="['map_server', 'amcl', 'controller_server', 'planner_server', 'behavior_server', 'bt_navigator']" \
    -p autostart:=true \
    -p use_sim_time:=true












cd ~/linorobot2_ws
colcon build --symlink-install
source install/setup.bash
ros2 run robot_state_publisher robot_state_publisher /tmp/robot.urdf
ros2 launch linorobot2_gazebo gazebo.launch.py urdf:=/tmp/robot.urdf





echo "4dw:"
grep -i "robot name" /tmp/test_final.urdf




打开rviz配置过程可能遇到map中有cannot received map问题：

方法一：
# 终端1：启动地图服务器
ros2 run nav2_map_server map_server --ros-args -p yaml_filename:="/opt/ros/humble/share/nav2_bringup/maps/turtlebot3_world.yaml"
# 终端1：启动地图服务器（使用linorobot2的地图）
ros2 run nav2_map_server map_server --ros-args \
    -p yaml_filename:="/home/jt/linorobot2_ws/src/linorobot2/linorobot2_navigation/maps/map.yaml" \
    -p use_sim_time:=true  # 如果是真实机器人用false，仿真用true

# 终端2：启动RViz
ros2 run rviz2 rviz2



方法二：
使用 Nav2 自带的 RViz 配置

# 直接使用Nav2的RViz配置（已经正确配置了地图）
ros2 launch nav2_bringup rviz_launch.py






由于修改了 src 下的源文件，你需要重新编译工作空间，让更改生效到 install 目录

cd /home/jt/linorobot2_ws
colcon build --symlink-install --packages-select linorobot2_description
source install/setup.bash

cd /home/jt/linorobot2_ws
rm -rf build/ install/
colcon build --symlink-install









ros2 run xacro xacro ~/linorobot2_ws/src/linorobot2/linorobot2_description/urdf/robots/4dw.urdf.xacro > /tmp/robot.urdf


ros2 run xacro xacro ~/linorobot2_ws/src/linorobot2/linorobot2_description/urdf/robots/4wd.urdf.xacro > /tmp/robot.urdf




  </gazebo>
  <gazebo>
    <plugin filename="libgazebo_ros_diff_drive.so" name="differential_drive_controller">
      <ros>
        <remapping>odom:=odom/unfiltered</remapping>
      </ros>
      <num_wheel_pairs>2</num_wheel_pairs>
      <left_joint>front_left_wheel_joint</left_joint>
      <right_joint>front_right_wheel_joint</right_joint>
      <left_joint>rear_left_wheel_joint</left_joint>
      <right_joint>rear_right_wheel_joint</right_joint>
      <wheel_separation>0.271</wheel_separation>
      <wheel_separation>0.271</wheel_separation>
      <wheel_diameter>0.14324</wheel_diameter>
      <wheel_diameter>0.14324</wheel_diameter>
      <updateRate>100</updateRate>
      <max_wheel_acceleration>1.0</max_wheel_acceleration>
      <robot_base_frame>base_footprint</robot_base_frame>
      <publish_odom>true</publish_odom>
      <publish_odom_tf>false</publish_odom_tf>
      <publish_wheel_tf>true</publish_wheel_tf>
      <odometry_frame>odom</odometry_frame>
    </plugin>
  </gazebo>
</robot>





<robot xmlns:xacro="http://ros.org/wiki/xacro">
  <xacro:macro name="imu">
    <link name="imu_link"/>
    
    <joint name="imu_to_base_link" type="fixed">
      <parent link="base_link"/>
      <child link="imu_link"/>
      <origin xyz="0 0 0" rpy="0 0 0"/>
    </joint>

    <gazebo reference="imu_link">
      <gravity>true</gravity>
      <sensor name="imu_sensor" type="imu">
      <always_on>true</always_on>
      <update_rate>20</update_rate>
      <visualize>true</visualize>
      <topic>__default_topic__</topic>
      <plugin filename="libgazebo_ros_imu_sensor.so" name="imu_plugin">
          <ros>
            <remapping>~/out:=imu/data</remapping>
          </ros>
          <topicName>imu/data</topicName>
          <bodyName>imu_link</bodyName>
          <updateRateHZ>10.0</updateRateHZ>
          <gaussianNoise>0.0</gaussianNoise>
          <xyzOffset>0 0 0</xyzOffset>
          <rpyOffset>0 0 0</rpyOffset>
          <frameName>imu_link</frameName>
          <initialOrientationAsReference>false</initialOrientationAsReference>
      </plugin>
      <pose>0 0 0 0 0 0</pose>
      </sensor>
    </gazebo>
  </xacro:macro>
</robot>













<?xml version="1.0"?>
<robot name="linorobot2_4wd" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <xacro:include filename="$(find linorobot2_description)/urdf/4wd_properties.urdf.xacro" />
  <xacro:include filename="$(find linorobot2_description)/urdf/mech/base.urdf.xacro" />
  <xacro:include filename="$(find linorobot2_description)/urdf/mech/wheel.urdf.xacro" />
  <xacro:include filename="$(find linorobot2_description)/urdf/sensors/imu.urdf.xacro" />
  <xacro:include filename="$(find linorobot2_description)/urdf/sensors/generic_laser.urdf.xacro" />
  <xacro:include filename="$(find linorobot2_description)/urdf/sensors/depth_sensor.urdf.xacro" />
  <xacro:include filename="$(find linorobot2_description)/urdf/sensors/camera.urdf.xacro" />
  <xacro:include filename="$(find linorobot2_description)/urdf/controllers/skid_steer.urdf.xacro" />

  <xacro:base 
    length="${base_length}" 
    width="${base_width}" 
    height="${base_height}" 
    mass="${base_mass}"
    wheel_radius="${wheel_radius}"
    wheel_pos_z="${wheel_pos_z}"
  />

  <!-- Front Left Wheel -->
  <xacro:wheel 
    side="front_left"
    radius="${wheel_radius}" 
    width="${wheel_width}" 
    pos_x="${wheel_pos_x}" 
    pos_y="${wheel_pos_y}" 
    pos_z="${wheel_pos_z}" 
    mass="${wheel_mass}"
  />

  <!-- Front Right Wheel -->
  <xacro:wheel 
    side="front_right"
    radius="${wheel_radius}" 
    width="${wheel_width}" 
    pos_x="${wheel_pos_x}" 
    pos_y="${-wheel_pos_y}" 
    pos_z="${wheel_pos_z}" 
    mass="${wheel_mass}"
  />

  <!-- Rear Left Wheel -->
  <xacro:wheel 
    side="rear_left"
    radius="${wheel_radius}" 
    width="${wheel_width}" 
    pos_x="${-wheel_pos_x}" 
    pos_y="${wheel_pos_y}" 
    pos_z="${wheel_pos_z}" 
    mass="${wheel_mass}"
  />

  <!-- Rear Right Wheel -->
  <xacro:wheel 
    side="rear_right"
    radius="${wheel_radius}" 
    width="${wheel_width}" 
    pos_x="${-wheel_pos_x}" 
    pos_y="${-wheel_pos_y}" 
    pos_z="${wheel_pos_z}" 
    mass="${wheel_mass}"
  />

  <!-- IMU -->
  <xacro:imu parent="base_link" xyz="0 0 0" rpy="0 0 0"/>

  <!-- Laser -->
  <xacro:generic_laser parent="base_link" prefix="front" xyz="0.18 0 0.06" rpy="0 0 0"/>

  <!-- Skid Steer Controller -->
  <xacro:skid_steer 
    front_left_wheel="front_left_wheel_joint"
    front_right_wheel="front_right_wheel_joint"
    rear_left_wheel="rear_left_wheel_joint"
    rear_right_wheel="rear_right_wheel_joint"
  />

</robot>









主目录：
~/linorobot2_ws/src/install/linorobot2_description/share/linorobot2_description/urdf/sensors$ nano generic_laser.urdf.xacro



<?xml version="1.0"?>
<robot xmlns:xacro="http://ros.org/wiki/xacro">
  <xacro:include filename="$(find linorobot2_description)/urdf/sensors/laser.urdf.xacro" />

  <xacro:macro name="generic_laser" params="*origin">
    <xacro:laser
      update_rate="10"
      ray_count="360"
      min_angle="-3.1416"
      max_angle="3.1416"
      min_range="0.08"
      max_range="12.0"
      frame_id="laser"
      topic_name="scan"
    >
      <xacro:insert_block name="origin" />
    </xacro:laser>
  </xacro:macro>

  <xacro:macro name="generic_base_laser" params="*origin">
    <xacro:laser
      update_rate="10"
      ray_count="360"
      min_angle="-3.1416"
      max_angle="3.1416"
      min_range="0.21"
      max_range="5.5"
      frame_id="base_laser"
      topic_name="base/scan"
    >
      <xacro:insert_block name="origin" />
    </xacro:laser>
  </xacro:macro>
</robot>











 nano ~/linorobot2_ws/src/linorobot2/linorobot2_description/urdf/controllers/skid_steer.urdf.xacro



<robot xmlns:xacro="http://ros.org/wiki/xacro">
  <xacro:macro name="diff_drive_controller" params="wheel_separation wheel_radius wheel_torque">
    <gazebo>
      <plugin name="differential_drive_controller" filename="libgazebo_ros_diff_drive.so">
        <ros>
          <remapping>odom:=odom/unfiltered</remapping>
        </ros>

        <num_wheel_pairs>2</num_wheel_pairs>
        <left_joint>front_left_wheel_joint</left_joint>
        <right_joint>front_right_wheel_joint</right_joint>
        <left_joint>rear_left_wheel_joint</left_joint>
        <right_joint>rear_right_wheel_joint</right_joint>

        <wheel_separation>${wheel_separation}</wheel_separation>
        <wheel_separation>${wheel_separation}</wheel_separation>
        <wheel_diameter>${wheel_radius * 2}</wheel_diameter>
        <wheel_diameter>${wheel_radius * 2}</wheel_diameter>

        <updateRate>100</updateRate>
        <max_wheel_acceleration>1.0</max_wheel_acceleration>
        <robot_base_frame>base_footprint</robot_base_frame>
        <publish_odom>true</publish_odom>
        <publish_odom_tf>false</publish_odom_tf>
        <publish_wheel_tf>true</publish_wheel_tf>
        <odometry_frame>odom</odometry_frame>
      </plugin>
    </gazebo>
  </xacro:macro>
</robot>








<xacro:macro name="skid_steer" params="front_left_wheel front_right_wheel rear_left_wheel rear_right_wheel">

<xacro:property name="wheel_radius" value="0.05" />
<xacro:property name="wheel_separation" value="0.18" />
<xacro:property name="wheel_torque" value="0.3" />



















nano /tmp/robot.urdf


<?xml version="1.0" ?>
<!-- =================================================================================== -->
<!-- |    This document was autogenerated by xacro from /home/jt/linorobot2_ws/src/linorobot2/linorobot2_description/urdf/robots/4wd.urdf.xacro | -->
<!-- |    EDITING THIS FILE BY HAND IS NOT RECOMMENDED                                 | -->
<!-- =================================================================================== -->
<robot name="linorobot2_4wd">
  <link name="base_footprint"/>
  <link name="base_link">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="0.445 0.2 0.129"/>
        <!-- <mesh filename="" scale="0.001 0.001 0.001"/> -->
      </geometry>
      <material name="yellow">
        <color rgba="0.8784 0.6627 0.6627 1.0"/>
      </material>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="0.445 0.2 0.129"/>
      </geometry>
    </collision>
    <inertial>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <mass value="10"/>
      <inertia ixx="0.04720083333333334" ixy="0.0" ixz="0.0" iyy="0.17888833333333332" iyz="0.0" izz="0.19835416666666666"/>
    </inertial>
  </link>
<gazebo reference="base_link">
    <visual>
      <material>
        <ambient>0.8392 0.6314 0.0 1.0</ambient>
        <diffuse>0.8392 0.6314 0.0 1.0</diffuse>
        <specular>0.99 0.99 0.99 1.0</specular>
        <emissive>0.0 0.0 0.0 0.0</emissive>
      </material>
    </visual>
  </gazebo>
  <joint name="base_to_footprint" type="fixed">
    <parent link="base_footprint"/>
    <child link="base_link"/>
    <origin rpy="0 0 0" xyz="0 0 0.09788"/>
  </joint>
  <link name="front_left_wheel_link">
    <visual>
      <origin rpy="1.5707963267948966 0 0" xyz="0 0 0"/>
      <geometry>
        <cylinder length="0.05" radius="0.05"/>
      </geometry>
      <material name="blue">
        <color rgba="0.1764 0.4588 0.8509 1.0"/>
      </material>
    </visual>
    <collision>
<origin rpy="1.5707963267948966 0 0" xyz="0 0 0"/>
      <geometry>
        <cylinder length="0.05" radius="0.05"/>
      </geometry>
    </collision>
    <inertial>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <mass value="0.6"/>
      <inertia ixx="0.0006000000000000001" ixy="0" ixz="0" iyy="0.0006000000000000001" iyz="0" izz="0.0006000000000000001"/>
    </inertial>
  </link>
  <gazebo reference="front_left_wheel_link">
    <visual>
      <material>
        <ambient>0.1764 0.4588 0.8509 1.0</ambient>
        <diffuse>0.1764 0.4588 0.8509 1.0</diffuse>
        <specular>0.1764 0.4588 0.8509 1.0</specular>
        <emissive>0.0 0.0 0.0 0.0</emissive>
      </material>
    </visual>
  </gazebo>
  <joint name="front_left_wheel_joint" type="continuous">
    <axis xyz="0 1 0"/>
    <parent link="base_link"/>
    <child link="front_left_wheel_link"/>
    <origin rpy="0 0 0" xyz="0.12 0.1355 -0.04788"/>
  </joint>
  <link name="front_right_wheel_link">
    <visual>






  </link>
  <gazebo reference="rear_right_wheel_link">
    <visual>
      <material>
        <ambient>0.1764 0.4588 0.8509 1.0</ambient>
        <diffuse>0.1764 0.4588 0.8509 1.0</diffuse>
        <specular>0.1764 0.4588 0.8509 1.0</specular>
        <emissive>0.0 0.0 0.0 0.0</emissive>
      </material>
    </visual>
  </gazebo>
  <joint name="rear_right_wheel_joint" type="continuous">
    <axis xyz="0 1 0"/>
    <parent link="base_link"/>
    <child link="rear_right_wheel_link"/>
    <origin rpy="0 0 0" xyz="-0.12 -0.1355 -0.04788"/>
  </joint>
  <link name="imu_link"/>
  <joint name="imu_to_base_link" type="fixed">
    <parent link="base_link"/>
    <child link="imu_link"/>
    <origin rpy="0 0 0" xyz="0 0 0"/>

  </joint>
  <gazebo reference="imu_link">
    <gravity>true</gravity>
    <sensor name="imu_sensor" type="imu">
      <always_on>true</always_on>
      <update_rate>20</update_rate>
      <visualize>true</visualize>
      <topic>__default_topic__</topic>
      <plugin filename="libgazebo_ros_imu_sensor.so" name="imu_plugin">
        <ros>
          <remapping>~/out:=imu/data</remapping>
        </ros>
        <topicName>imu/data</topicName>
        <bodyName>imu_link</bodyName>
        <updateRateHZ>10.0</updateRateHZ>
        <gaussianNoise>0.0</gaussianNoise>
        <xyzOffset>0 0 0</xyzOffset>
        <rpyOffset>0 0 0</rpyOffset>
        <frameName>imu_link</frameName>
        <initialOrientationAsReference>false</initialOrientationAsReference>
      </plugin>
      <pose>0 0 0 0 0 0</pose>
    </sensor>
  </gazebo>
  <link name="base_link">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 -0.025"/>

      <geometry>
        <cylinder length="0.05" radius="0.0375"/>
      </geometry>
      <material name="green">
        <color rgba="0.003 0.639 0.223 1.0"/>
      </material>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 -0.025"/>
      <geometry>
        <cylinder length="0.05" radius="0.0375"/>
      </geometry>
    </collision>
    <inertial>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <mass value="0.1"/>
      <inertia ixx="5.625000000000001e-05" ixy="0" ixz="0" iyy="5.625000000000001e-05" iyz="0" izz="5.625000000000001e-05"/>
    </inertial>
  </link>
  <gazebo reference="base_link">
    <visual>
      <material>
        <ambient>0.003 0.639 0.223 1.0</ambient>
        <diffuse>0.003 0.639 0.223 1.0</diffuse>
        <specular>0.003 0.639 0.223 1.0</specular>
        <emissive>0.0 0.0 0.0 0.0</emissive>
      </material>
    </visual>
  </gazebo>

  </joint>
  <gazebo reference="base_link">
    <sensor name="base_link_lidar" type="gpu_ray">
      <always_on>true</always_on>
      <update_rate>10</update_rate>
      <pose>0 0 0 0 0 0</pose>
      <visualize>false</visualize>
      <ray>
        <scan>
          <horizontal>
            <samples>360</samples>
            <resolution>1</resolution>
            <min_angle>-3.1416</min_angle>
            <max_angle>3.1416</max_angle>
          </horizontal>
        </scan>
        <range>
          <min>0.08</min>
          <max>12.0</max>
          <resolution>0.01</resolution>
        </range>
      <ray>
        <scan>
          <horizontal>
            <samples>360</samples>
            <resolution>1</resolution>
            <min_angle>-3.1416</min_angle>
            <max_angle>3.1416</max_angle>
          </horizontal>
        </scan>
        <range>
          <min>0.08</min>
          <max>12.0</max>
          <resolution>0.01</resolution>
        </range>
      </ray>
      <plugin filename="libgazebo_ros_ray_sensor.so" name="base_link_lidar_controller">
        <ros>
          <remapping>~/out:=front/scan</remapping>
        </ros>
        <output_type>sensor_msgs/LaserScan</output_type>
        <alwaysOn>true</alwaysOn>
        <updateRate>10</updateRate>
        <topicName>front/scan</topicName>
        <frame_name>base_link</frame_name>
        <output_type>sensor_msgs/LaserScan</output_type>
      </plugin>
    </sensor>
  </gazebo>
  <gazebo>
    <plugin filename="libgazebo_ros_diff_drive.so" name="differential_drive_controller">
      <ros>
        <remapping>odom:=odom/unfiltered</remapping>
      </ros>
      <num_wheel_pairs>2</num_wheel_pairs>
      <left_joint>front_left_wheel_joint</left_joint>
      <right_joint>front_right_wheel_joint</right_joint>
      <left_joint>rear_left_wheel_joint</left_joint>
      <right_joint>rear_right_wheel_joint</right_joint>
      <wheel_separation>0.2</wheel_separation>
      <wheel_separation>0.2</wheel_separation>
      <wheel_diameter>0.1</wheel_diameter>
      <wheel_diameter>0.1</wheel_diameter>
      <updateRate>100</updateRate>
      <max_wheel_acceleration>1.0</max_wheel_acceleration>
      <robot_base_frame>base_footprint</robot_base_frame>
      <publish_odom>true</publish_odom>
      <publish_odom_tf>false</publish_odom_tf>
      <publish_wheel_tf>true</publish_wheel_tf>
      <odometry_frame>odom</odometry_frame>
    </plugin>
  </gazebo>
</robot>














skid_steer.urdf.xacro


<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">
  <xacro:macro name="skid_steer" params="front_left_wheel front_right_wheel rear_left_wheel rear_right_wheel wheel_separation wheel_radius wheel_torque">
    <gazebo>
      <plugin name="differential_drive_controller" filename="libgazebo_ros_diff_drive.so">
        <ros>
          <remapping>odom:=odom/unfiltered</remapping>
        </ros>

        <num_wheel_pairs>2</num_wheel_pairs>
        <left_joint>${front_left_wheel}</left_joint>
        <right_joint>${front_right_wheel}</right_joint>
        <left_joint>${rear_left_wheel}</left_joint>
        <right_joint>${rear_right_wheel}</right_joint>

        <wheel_separation>${wheel_separation}</wheel_separation>
        <wheel_separation>${wheel_separation}</wheel_separation>
        <wheel_diameter>${wheel_radius * 2}</wheel_diameter>
        <wheel_diameter>${wheel_radius * 2}</wheel_diameter>

        <updateRate>100</updateRate>
        <max_wheel_acceleration>1.0</max_wheel_acceleration>
        <robot_base_frame>base_footprint</robot_base_frame>
        <publish_odom>true</publish_odom>
        <publish_odom_tf>false</publish_odom_tf>
        <publish_wheel_tf>true</publish_wheel_tf>
        <odometry_frame>odom</odometry_frame>
      </plugin>
    </gazebo>
  </xacro:macro>
</robot>




最新版本：


jt@jt-virtual-machine:~/history_ros$ jt@jt-virtual-machine:~/linorobot2_ws$ ros2 launch linorobot2_gazebo gazebo.launch.pyros2 launch linorobot2_gazebo gazebo.launch.py












2026.2.3


<?xml version="1.0"?>
<?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>
<package format="3">
  <name>my_robot_bringup</name>
  <version>0.0.0</version>
  <description>TODO: Package description</description>
  <maintainer email="3326288718@qq.com">jt</maintainer>
  <license>TODO: License declaration</license>

  <depend>rclpy</depend>
  <depend>geometry_msgs</depend>
  <depend>sensor_msgs</depend>
  <depend>tf2_ros</depend>
  <depend>std_msgs</depend>

  <test_depend>ament_copyright</test_depend>
  <test_depend>ament_flake8</test_depend>
  <test_depend>ament_pep257</test_depend>
  <test_depend>python3-pytest</test_depend>

  <export>
    <build_type>ament_python</build_type>
  </export>
</package>















MIT License

Copyright (c) 2024 FYteam

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
EOF






cp ~/下载/nav_launch.py ./launch/
cp ~/下载/keyboard_teleop.py ~/下载/serial_node.py ~/下载/odometry_node.py ./my_robot_bringup/nodes/







这是setup.py:


from setuptools import find_packages, setup

package_name = 'my_robot_bringup'

setup(
    name=package_name,
    version='0.0.0',
    packages=find_packages(exclude=['test']),
    data_files=[
        ('share/ament_index/resource_index/packages',
            ['resource/' + package_name]),
        ('share/' + package_name, ['package.xml']),
    ],
    install_requires=['setuptools'],
    zip_safe=True,
    maintainer='jt',
    maintainer_email='3326288718@qq.com',
    description='TODO: Package description',
    license='TODO: License declaration',
    extras_require={
        'test': [
            'pytest',
        ],
    },
    entry_points={
        'console_scripts': [
        ],
    },
)

























目标：用笔记本（虚拟机） + USB-TTL 直接连接 STM32
只实现最基础功能：键盘（WASD/X）控制小车前进/后退/左转/右转/停止
STM32 程序：只能接收 cmd_vel 对应的帧（0xAA + 4字节速度 + 0x55），收到后驱动电机
不需要：里程计（odometry_node.py）、launch 文件、编码器反馈

✅ 你只需要改这两个文件：

serial_node.py（核心，必须改）
setup.py（确保 serial_node 可运行）

odometry_node.py 和 nav_launch.py 可以完全不动（先不使用）。
第一步：确认你的 USB-TTL 串口名
在笔记本虚拟机里运行：
ls /dev/ttyUSB* /dev/ttyACM* 2>/dev/null
通常会看到：

/dev/ttyUSB0 （最常见）
/dev/ttyACM0

记下正确的名字（比如 /dev/ttyUSB0）
第二步：修改 serial_node.py（简化版，只做发送）
cd ~/linorobot2_ws/src/my_robot_bringup/my_robot_bringup/nodes
nano serial_node.py
把整个文件替换成下面这个简化版（只保留发送功能，删除读取编码器部分）：
Python#!/usr/bin/env python3
import rclpy
from rclpy.node import Node
from geometry_msgs.msg import Twist
import serial

class SerialNode(Node):
    def __init__(self):
        super().__init__('serial_node')
        
        # ========== 修改这里：你的实际串口名 ==========
        self.declare_parameter('serial_port', '/dev/ttyUSB0')   # ← 改成你 ls 看到的串口
        self.declare_parameter('baudrate', 115200)
        
        port = self.get_parameter('serial_port').value
        baud = self.get_parameter('baudrate').value
        
        try:
            self.ser = serial.Serial(port, baud, timeout=0.1)
            self.get_logger().info(f"✅ 串口打开成功：{port} @ {baud}")
        except Exception as e:
            self.get_logger().error(f"❌ 串口打开失败：{e}")
            rclpy.shutdown()
            return

        # 订阅键盘发出的 /cmd_vel
        self.cmd_vel_sub = self.create_subscription(
            Twist, '/cmd_vel', self.cmd_vel_callback, 10)

    def cmd_vel_callback(self, msg):
        linear = max(-1.0, min(1.0, msg.linear.x))
        angular = max(-1.0, min(1.0, msg.angular.z))

        # 映射为 16位无符号整数（-1 → 0, 0 → 32768, 1 → 65535）
        linear_u16 = int((linear + 1.0) / 2.0 * 65535)
        angular_u16 = int((angular + 1.0) / 2.0 * 65535)

        # 拆分高低字节
        linear_high = (linear_u16 >> 8) & 0xFF
        linear_low  = linear_u16 & 0xFF
        angular_high = (angular_u16 >> 8) & 0xFF
        angular_low  = angular_u16 & 0xFF

        # STM32 要求的帧格式
        frame = bytes([0xAA, linear_high, linear_low, angular_high, angular_low, 0x55])

        try:
            self.ser.write(frame)
            self.get_logger().info(f"发送 → STM32: {frame.hex()} | v={linear:.2f} wz={angular:.2f}")
        except Exception as e:
            self.get_logger().error(f"发送失败: {e}")

    def destroy_node(self):
        if hasattr(self, 'ser') and self.ser.is_open:
            self.ser.close()
        super().destroy_node()

def main(args=None):
    rclpy.init(args=args)
    node = SerialNode()
    rclpy.spin(node)
    rclpy.shutdown()

if __name__ == '__main__':
    main()
保存退出。
第三步：修改 setup.py
cd ~/linorobot2_ws/src/my_robot_bringup
nano setup.py
在 entry_points 里确保有这一行：
Python'console_scripts': [
    'serial_node = my_robot_bringup.nodes.serial_node:main',
],
第四步：构建并运行
cd ~/linorobot2_ws
colcon build --packages-select my_robot_bringup
source install/setup.bash
ros2 run my_robot_bringup serial_node
如果看到：
text串口打开成功：/dev/ttyUSB0 @ 115200
→ 成功！
然后新开一个终端运行键盘：
ros2 run teleop_twist_keyboard teleop_twist_keyboard
或者：
ros2 run teleop_twist_keyboard teleop_twist_keyboard --ros-args -r /cmd_vel:=/cmd_vel
按 w/a/s/d/x 测试小车是否动。
请告诉我：

你 ls /dev/tty* 看到的是哪个串口名？（比如 ttyUSB0）
运行 ros2 run my_robot_bringup serial_node 后的日志








简单的说三步走：
1.0 
保持 serial_node 运行（终端1）：ros2 run my_robot_bringup serial_node
确认看到 “✅ 串口打开成功：/dev/ttyUSB0 @ 115200”
让它保持运行，不要 Ctrl+C 关闭


2.0
新开一个终端，运行键盘节点（终端2）：ros2 run teleop_twist_keyboard teleop_twist_keyboard
它会打印键盘说明（类似：w 前进、s 后退、a 左转、d 右转、x 停止 等）
按住 w 键（前进），看 serial_node 终端是否打印非零速度的帧，例如：text发送 → STM32: aa8000800055 | v=0.20 wz=0.00（aa80 00 80 00 55 表示 v=0.2 前进）

如果还是只打印 aa7fff7fff55（v=0 wz=0）：
说明键盘没把速度传过去，强制 remap 话题名：ros2 run teleop_twist_keyboard teleop_twist_keyboard --ros-args -r /cmd_vel:=/cmd_vel
再按 w，看 serial_node 是否变帧


3.0
如果还是只发停止帧，用 topic echo 确认新开终端3：ros2 topic echo /cmd_vel按 w 键，看是否有：textlinear:
  x: 0.5
  y: 0.0
  z: 0.0
angular:
  x: 0.0
  y: 0.0
  z: 0.0
有输出 → 键盘在发，但 serial_node 没收到（QoS 或订阅问题）
没输出 → 键盘节点没发消息，重装 teleop_twist_keyboard：sudo apt install ros-humble-teleop-twist-keyboard -y








