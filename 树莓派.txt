é‡è¦ä¿®æ”¹ï¼šsudo nano /boot/firmware/cmdline.txt
åŸæœ¬å†…å®¹ï¼šconsole=serial0,115200 multipath=off dwc_otg.lpm_enable=0 console=tty1 root=LABEL=writable rootfstype=ext4 rootwait fixrtc cfg80211.ieee80211_regdom=


ä¿®æ”¹ï¼šsudo nano /boot/firmware/config.txt

åŸæœ¬å†…å®¹ï¼š
max_framebuffers=2
arm_boost=1

[all]
# Enable the audio output, I2C and SPI interfaces on the GPIO header. As these
# parameters related to the base device-tree they must appear *before* any
# other dtoverlay= specification
dtparam=audio=on
dtparam=i2c_arm=on
dtparam=spi=on

# Comment out the following line if the edges of the desktop appear outside
# the edges of your display
disable_overscan=1

# If you have issues with audio, you may try uncommenting the following line
# which forces the HDMI output into HDMI mode instead of DVI (which doesn't
# support audio output)
#hdmi_drive=2

# Enable the serial pins
enable_uart=1

# Autoload overlays for any recognized cameras or displays that are attached
# to the CSI/DSI ports. Please note this is for libcamera support, *not* for
# the legacy camera stack
camera_auto_detect=1
display_auto_detect=1

# Config settings specific to arm64
arm_64bit=1
dtoverlay=dwc2

[cm4]
# Enable the USB2 outputs on the IO board (assuming your CM4 is plugged into
# such a board)
dtoverlay=dwc2,dr_mode=host

[all]







sudo systemctl stop apt-daily.timer apt-daily-upgrade.timer
sudo systemctl disable apt-daily.timer apt-daily-upgrade.timer unattended-upgrades



sudo sed -i '/^[^#]*ClientAliveInterval/d; /^[^#]*ClientAliveCountMax/d' /etc/ssh/sshd_config && echo -e "ClientAliveInterval 60\nClientAliveCountMax 3" | sudo tee -a /etc/ssh/sshd_config && sudo systemctl restart ssh


sudo reboot

systemctl list-timers | grep -E "(apt-daily|apt-upgrade)"  # åº”è¯¥æŸ¥è¯¢ä¸åˆ°ä»»ä½•æ¿€æ´»çš„è®¡æ—¶å™¨






ç›®å‰ç”¨ä¸åˆ°å›¾å½¢åŒ–ç•Œé¢æ‰€ä»¥è¿œç¨‹è¿æ¥æ²¡æœ‰ç”¨ï¼š
sudo apt-get update
sudo apt-get install xrdp
sudo systemctl status xrdp



[Match]
Name=eth0 # æœ‰çº¿ç½‘å¡åï¼Œä¹Ÿå¯èƒ½æ˜¯enå¼€å¤´çš„ï¼Œå¦‚ens33

[Network]
Address=192.168.1.100/24 # ä½ æƒ³è¦çš„é™æ€IPå’Œå­ç½‘æ©ç (/24=255.255.255.0)
Gateway=192.168.1.1 # ä½ åœ¨â€œé…ç½®å‰â€æ­¥éª¤è·å–çš„ç½‘å…³åœ°å€
DNS=192.168.1.1 # ä½ è·å–çš„DNSåœ°å€ï¼Œæˆ–ä½¿ç”¨å…¬å…±DNSå¦‚8.8.8.8












ä¸€ã€ä½ ç°åœ¨çš„ç³»ç»Ÿè¾¹ç•Œï¼ˆå…ˆå¯¹é½è®¤çŸ¥ï¼‰

å½“å‰é˜¶æ®µ ä¸éœ€è¦ ROS2ï¼Œå¦åˆ™ä¼šæŠŠé—®é¢˜å¤æ‚åŒ–ã€‚

ä½ ç°åœ¨è¦éªŒè¯çš„æ˜¯ï¼š

ç¬”è®°æœ¬ï¼ˆè™šæ‹Ÿæœºï¼‰ â†’ USB ä¸²å£ â†’ STM32 â†’ CAN â†’ å°ç±³ç”µæœº â†’ è½®å­è½¬

æ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªçº¯ä¸²å£æ§åˆ¶é“¾è·¯éªŒè¯ã€‚

äºŒã€ç‰©ç†è¿æ¥ä½ åº”è¯¥æ˜¯è¿™æ ·çš„ï¼ˆå†ç¡®è®¤ä¸€æ¬¡ï¼‰
1ï¸âƒ£ STM32 â†” ç¬”è®°æœ¬

STM32 çš„ Type-C æ¥å£

ä¸€æ ¹ USB çº¿æ’åˆ°ç¬”è®°æœ¬ï¼ˆæˆ–è™šæ‹Ÿæœºæ˜ å°„ï¼‰

STM32 ä¼šåœ¨ç³»ç»Ÿé‡Œè¡¨ç°ä¸ºï¼š

/dev/ttyACM0
# æˆ–
/dev/ttyUSB0

2ï¸âƒ£ STM32 â†” CAN æ¨¡å— â†” å››ä¸ª CyberGear

ä½ å·²ç»å®Œæˆ âœ”
ï¼ˆCAN_H / CAN_L / 120Î© ç»ˆç«¯ï¼‰

ä¸‰ã€ç¬”è®°æœ¬ä¸Šä½ éœ€è¦å‡†å¤‡ä»€ä¹ˆï¼ˆåªåš 3 ä»¶äº‹ï¼‰
âœ… 1. æ‰¾åˆ° STM32 çš„ä¸²å£è®¾å¤‡

åœ¨è™šæ‹Ÿæœºç»ˆç«¯æ‰§è¡Œï¼š

ls /dev/tty*


æ’æ‹”ä¸€æ¬¡ STM32ï¼Œå†æ‰§è¡Œï¼š

ls /dev/tty*


æ–°å‡ºç°çš„é‚£ä¸ªå°±æ˜¯ STM32ï¼Œä¾‹å¦‚ï¼š

/dev/ttyACM0


è®°ä½è¿™ä¸ªåå­—ã€‚

âœ… 2. å®‰è£…ä¸²å£å·¥å…·ï¼ˆå¿…é¡»ï¼‰

æˆ‘æ¨èä½ å…ˆç”¨ minicomï¼Œæœ€ç¨³ï¼š

sudo apt update
sudo apt install minicom


ï¼ˆå¯é€‰ï¼šscreen / cutecomï¼Œä½† minicom è¶³å¤Ÿï¼‰

âœ… 3. æ‰“å¼€ä¸²å£ï¼ˆå…³é”®ï¼‰
sudo minicom -D /dev/ttyACM0 -b 115200


âš ï¸ 115200 å¿…é¡»å’Œä½  STM32 ç¨‹åºé‡Œ UART æ³¢ç‰¹ç‡ä¸€è‡´
ï¼ˆå¦‚æœä½ ç”¨çš„æ˜¯ 9600 / 921600ï¼Œè¦æ”¹ï¼‰

è¿›å…¥åä½ ä¼šçœ‹åˆ°ä¸€ä¸ªé»‘çª—å£ï¼Œè¿™å°±æ˜¯ä½ å’Œ STM32 çš„â€œå¯¹è¯çª—å£â€ã€‚

å››ã€ä½ ç°åœ¨è¦å‘é€ä»€ä¹ˆâ€œæŒ‡ä»¤â€ï¼ˆé‡ç‚¹ï¼‰

è¿™ä¸€æ­¥ å®Œå…¨å–å†³äºä½  STM32 ç¨‹åºé‡Œå†™äº†ä»€ä¹ˆä¸²å£åè®®ã€‚

æˆ‘ç»“åˆä½ ä¹‹å‰å‘è¿‡çš„ä»£ç ï¼Œç»™ä½ ä¸€ä¸ªç°å®ä¸­æœ€å¸¸è§ã€ä½ å¾ˆå¯èƒ½å·²ç»æœ‰çš„æƒ…å†µï¼š

æƒ…å†µ Aï¼ˆæœ€å¸¸è§ï¼‰ï¼šSTM32 ç”¨çš„æ˜¯ã€Œå•å­—ç¬¦æ§åˆ¶ã€

ä½  STM32 ä»£ç é‡Œå¤§æ¦‚ç‡æœ‰ç±»ä¼¼ï¼š

if (rx_data == 'w') å‰è¿›
if (rx_data == 's') åé€€
if (rx_data == 'a') å·¦è½¬
if (rx_data == 'd') å³è½¬
if (rx_data == 'x') åœæ­¢

é‚£ä½ åœ¨ minicom é‡Œç›´æ¥æŒ‰é”®ï¼š
w   â†’ å››è½®å‰è¿›
s   â†’ å››è½®åé€€
a   â†’ å·¦è½¬
d   â†’ å³è½¬
x   â†’ åœ


âš ï¸ æ³¨æ„ï¼š

ä¸è¦æŒ‰å›è½¦

æ˜¯ç›´æ¥æŒ‰å­—æ¯

æƒ…å†µ Bï¼šSTM32 ç”¨çš„æ˜¯å­—ç¬¦ä¸²æŒ‡ä»¤ï¼ˆå¸¦å›è½¦ï¼‰

æ¯”å¦‚ï¼š

"FWD\n"
"BACK\n"
"STOP\n"


é‚£ä½ åœ¨ minicom é‡Œè¾“å…¥ï¼š

FWD


ç„¶å å›è½¦

æƒ…å†µ Cï¼ˆæ›´é«˜çº§ï¼‰ï¼šé€Ÿåº¦æŒ‡ä»¤

æ¯”å¦‚ä½ ç¨‹åºé‡Œæœ‰ï¼š

V 100 100 100 100\n


é‚£ä½ åœ¨ minicom è¾“å…¥ï¼š

V 100 100 100 100

ğŸ”´ å¦‚æœä½ ä¸ç¡®å®šæ˜¯å“ªç§

ğŸ‘‰ é©¬ä¸Šåšä¸€ä»¶äº‹ï¼š

åœ¨ STM32 ä¸²å£æ¥æ”¶å›è°ƒé‡ŒåŠ ä¸€å¥ï¼š

printf("RX: %c\r\n", rx_data);


è¿™æ ·ä½ åœ¨ minicom é‡Œèƒ½çœ‹åˆ° STM32 æ”¶åˆ°äº†ä»€ä¹ˆã€‚

äº”ã€å®Œæ•´â€œæœ€å°æˆåŠŸé—­ç¯â€ï¼ˆä½ ç…§è¿™ä¸ªé¡ºåºï¼‰
Step 1
sudo minicom -D /dev/ttyACM0 -b 115200

Step 2

ç¡®è®¤ STM32 ä¸Šç”µåï¼š

CAN åˆå§‹åŒ–å®Œæˆ

å››ä¸ªç”µæœºå·² enable

ï¼ˆCyberGear ä¸ enable æ˜¯ä¸ä¼šåŠ¨çš„ï¼‰

Step 3

åœ¨ minicom ä¸­æŒ‰ï¼š

w

Step 4

è§‚å¯Ÿï¼š

ç”µæœºæ˜¯å¦é¸£å« / è½»å¾®æŠ–åŠ¨

æ˜¯å¦æœ‰ä¸€ä¸ªè½®å­å…ˆåŠ¨

å…­ã€å¦‚æœã€Œå®Œå…¨ä¸åŠ¨ã€ï¼Œä½ æŒ‰è¿™ä¸ªé¡ºåºæ’é”™
â‘  ä¸²å£æœ‰æ²¡æœ‰æ•°æ®ï¼Ÿ

STM32 ä¸²å£é‡Œæ‰“å°ï¼š

printf("hello\r\n");


minicom èƒ½ä¸èƒ½çœ‹åˆ°ï¼Ÿ

â‘¡ STM32 æ”¶åˆ°æŒ‡ä»¤äº†å—ï¼Ÿ
printf("rx=%c\r\n", rx_data);

â‘¢ CAN å‘å‡ºå»äº†å—ï¼Ÿ

åœ¨ CAN_Tx åæ‰“ç‚¹ï¼ˆLED æˆ– printfï¼‰

â‘£ CyberGear ID å¯¹å—ï¼Ÿ

ä½ ä¹‹å‰è®¾ç½®çš„ï¼š

ID = 1 / 2 / 3 / 4


å’Œç¨‹åºé‡Œå®Œå…¨ä¸€è‡´ï¼Ÿ

ä¸ƒã€ä½ ä¸‹ä¸€æ­¥è¯¥å¹²ä»€ä¹ˆï¼ˆè·¯çº¿å›¾ï¼‰

âœ” å½“å‰é˜¶æ®µç›®æ ‡ï¼ˆç°åœ¨ï¼‰

ç”¨ minicom æ§åˆ¶å››è½®è·‘èµ·æ¥

âœ” ä¸‹ä¸€é˜¶æ®µï¼ˆä½ é©¬ä¸Šä¼šé—®ï¼‰

ç”¨ ROS2 cmd_vel â†’ STM32

âœ” å†ä¸‹ä¸€é˜¶æ®µ

Nav2 è‡ªåŠ¨å¯¼èˆª









å››ã€ä¸€æ­¥ä¸€æ­¥ï¼šåœ¨æ ‘è“æ´¾ä¸Šè·‘ keyboard_uart.py
ğŸ“ å‰æç¡®è®¤ï¼ˆä½ å·²ç»æ»¡è¶³ï¼‰

Xshell å·²ç» ssh ç™»å½•è¿›æ ‘è“æ´¾

STM32 é€šè¿‡ UART æ¥åˆ°æ ‘è“æ´¾

è®¾å¤‡æ˜¯ /dev/ttyAMA0

â‘  åœ¨æ ‘è“æ´¾ä¸Šæ–°å»ºè„šæœ¬

åœ¨ Xshell ç»ˆç«¯é‡Œæ•²ï¼š

cd ~
nano keyboard_uart.py

â‘¡ ç²˜è´´è¿™ä¸ªã€æœ€å°å¯ç”¨ã€‘è„šæœ¬ï¼ˆä¸è¦æ”¹ï¼‰
import serial
import sys
import termios
import tty

ser = serial.Serial(
    port='/dev/ttyAMA0',
    baudrate=115200,
    timeout=0.1
)

print("Press keys (w/a/s/d/x), Ctrl+C to exit")

fd = sys.stdin.fileno()
old_settings = termios.tcgetattr(fd)

try:
    tty.setraw(fd)
    while True:
        ch = sys.stdin.read(1)
        if ch:
            ser.write(ch.encode())
            print(f"send: {ch}")
except KeyboardInterrupt:
    pass
finally:
    termios.tcsetattr(fd, termios.TCSADRAIN, old_settings)
    ser.close()


ä¿å­˜ï¼š

Ctrl + O

å›è½¦

Ctrl + X

â‘¢ ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x keyboard_uart.py

â‘£ è¿è¡Œè„šæœ¬ï¼ˆé‡ç‚¹ï¼‰
python3 keyboard_uart.py


âš ï¸ æ³¨æ„ï¼š

ä¸æ˜¯åŒå‡»

ä¸æ˜¯åœ¨ Windows è·‘

å°±æ˜¯åœ¨ Xshell è¿™ä¸ªçª—å£

â‘¤ æŒ‰é”®æµ‹è¯•

åœ¨è¿™ä¸ªç»ˆç«¯é‡Œç›´æ¥æŒ‰ï¼š

w
a
s
d
x













# æµ‹è¯•ç½‘ç»œè¿é€šæ€§
ping -c 4 8.8.8.8

# æµ‹è¯•åŸŸåè§£æ
nslookup mirrors.aliyun.com



/dev/ttyAMA0
sudo chmod 666 /dev/ttyAMA0



nano ~/keyboard_uart.py



ps aux | grep keyboard_uart.py
kill -9 <pid>



import serial

ser = serial.Serial(
    port='/dev/ttyAMA0',
    baudrate=115200,
    timeout=1
)

print("Type a character and press Enter (Ctrl+C to exit)")

try:
    while True:
        s = input("> ")
        if not s:
            continue

        ch = s[0]          # åªå–ç¬¬ä¸€ä¸ªå­—ç¬¦
        ser.write(ch.encode())
        print(f"send: {ch}")

        data = ser.read(1)
        if data:
            print(f"recv: {data.decode(errors='ignore')}")
        else:
            print("recv: <nothing>")
except KeyboardInterrupt:
    print("\nExit")
finally:
    ser.close()


python3 keyboard_uart.py




cat /dev/ttyAMA0
echo "hello" > /dev/ttyAMA0


# é…ç½®ä¸²å£ï¼ˆå¦‚æœæœªå¯ç”¨ï¼Œéœ€å…ˆåœ¨ raspi-config ä¸­å¯ç”¨ï¼‰
stty -F /dev/ttyAMA0 115200
# æµ‹è¯•å›ç¯
echo "test" > /dev/ttyAMA0
cat < /dev/ttyAMA0